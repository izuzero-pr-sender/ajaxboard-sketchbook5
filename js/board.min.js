/**
 * AJAXBoard XE Module Javascript
 * Copyright (C) 아약스보드. All rights reserved.
 **/
!function(e){AJAXBoardDocPlugin=xe.createPlugin("AJAXBoardDocPlugin",{init:function(e){e.registerPlugin(this);var t=[["clearCommentEditor","after",this.triggerClearCommentEditor],["events.connect","after",this.triggerConnect],["events.documentVoteUp","before",this.triggerDocumentVoteUp],["events.documentVoteDown","before",this.triggerDocumentVoteDown],["events.insertComment","before",this.triggerInsertComment],["events.deleteComment","before",this.triggerDeleteComment],["events.commentVoteUp","before",this.triggerCommentVoteUp],["events.commentVoteDown","before",this.triggerCommentVoteDown],["events.insertDocument","before",this.triggerDispDocumentList],["events.deleteDocument","before",this.triggerDispDocumentList],["events.documentVoteUp","before",this.triggerDispDocumentList],["events.documentVoteDown","before",this.triggerDispDocumentList],["events.insertComment","before",this.triggerDispDocumentList],["events.deleteComment","before",this.triggerDispDocumentList],["events.commentVoteUp","before",this.triggerDispDocumentList],["events.commentVoteDown","before",this.triggerDispDocumentList]];for(var o in t)e.insertTrigger(t[o][0],t[o][1],t[o][2])},triggerClearCommentEditor:function(){e("div.simple_wrt textarea[id^='editor_']").val("")},triggerConnect:function(){var t=this;"function"==typeof reComment&&(originReComment=reComment,reComment=function(e,o,n){t.recomment=!0,originReComment(e,o,n)}),"function"==typeof doCallModuleAction&&(doCallOriginModuleAction=doCallModuleAction,doCallModuleAction=function(t,o,n){var i=["procDocumentVoteUp","procDocumentVoteDown","procDocumentDeclare","procCommentVoteUp","procCommentVoteDown","procCommentDeclare"];for(var r in i)if(o==i[r]){var m={target_srl:n,cur_mid:current_mid,mid:current_mid};return exec_xml(t,o,m)}e.isFunction(doCallOriginModuleAction)&&doCallOriginModuleAction(t,o,n)}),"function"==typeof completeInsertComment&&(completeInsertComment=function(e){t.clearCommentEditor(),t.scrollToComment(2,t.animatetime||1,"#comment_"+e.comment_srl)}),"function"==typeof completeDeleteComment&&(completeDeleteComment=function(){}),e("div#cmtPosition").on("click","div.fdb_nav [href]",function(){var t=e(this),o=t.attr("href");o.indexOf("#")>-1&&(o=o.substring(0,o.indexOf("#")));var n=o.getQuery("act"),i=o.getQuery("comment_srl");return i&&"dispBoardDeleteComment"==n?(oAJAXBoard.deleteComment(o,i),!1):void 0}).on("click","div.bd_pg [href], div.cmt_pg [href]",function(){var t=e(this),o=t.attr("href");o.indexOf("#")>-1&&(o=o.substring(0,o.indexOf("#")));var n=o.getQuery("cpage");return oAJAXBoardDocPlugin.dispCommentsByCpage(n>1&&t.hasClass("direction")?"":n),!1}),e("div#re_cmt a.close").on("click",this,function(){e("div#re_cmt").hide(),oAJAXBoard.recomment=!1,oAJAXBoardDocPlugin.dispComment()}),e("div#re_cmt input[type=submit]").on("click",this,function(){e("div#re_cmt").hide(),oAJAXBoard.recomment=!1}),e("div.bd_lst_wrp").on("click","div.bd_pg [href]",function(){var t=e(this),o=t.attr("href");return o.indexOf("#")>-1&&(o=o.substring(0,o.indexOf("#"))),oAJAXBoardDocPlugin.dispDocumentListByPage(o.getQuery("page")),!1})},triggerDocumentVoteUp:function(t,o){this.document_srl==t&&(e("div.rd_vote").children().eq(0).children().eq(0).html("♥ "+o),e("div.addon_addvote button.btn_voted span.num").html(o))},triggerDocumentVoteDown:function(t,o){this.document_srl==t&&(e("div.rd_vote").children().eq(1).children().eq(0).html("♥ "+o),e("div.addon_addvote button.btn_blamed span.num").html(o))},triggerInsertComment:function(t){e("div#comment").length&&this.document_srl==t||oAJAXBoardDocPlugin.dispComment()},triggerDeleteComment:function(t){e("div#comment").length&&e("#comment_"+t).length||oAJAXBoardDocPlugin.dispComment()},triggerCommentVoteUp:function(t,o){!this.recomment&&e("#comment_"+o).length&&(this.recomment=!1,oAJAXBoardDocPlugin.dispComment())},triggerCommentVoteDown:function(t,o){!this.recomment&&e("#comment_"+o).length&&(this.recomment=!1,oAJAXBoardDocPlugin.dispComment())},triggerDispDocumentList:function(){oAJAXBoardDocPlugin.dispDocumentList()},dispComment:function(t){var o=this,n=e("div#cmtPosition");if(!n.length)return!1;if(this.oApp.recomment)return e("a.cmt_alert").length||e("ul.fdb_lst_ul").append(e("<a class=\"cmt_alert message info\" onclick=\"jQuery('div#re_cmt a.close').trigger('click')\">새로운 댓글이 있습니다. 클릭하면 새로운 댓글을 불러옵니다.</a>")),!1;this.oApp.startAjax();var i=this.oApp.getPagesHandler(t);return i.done(function(t){t=e("<div>").append(e.parseHTML(t)).find("div#cmtPosition"),e("a.cmt_alert").remove(),e("div#re_cmt").appendTo(e("div.cmt_editor")),e("div#cmtPosition").html(t.html())}).fail(function(e,t,o){try{console.error("%s: %s, %o",t,o,e)}catch(n){}}).always(function(){o.oApp.stopAjax()}),i},dispCommentsByCpage:function(e){var t=this;return this.dispComment({cpage:e}).done(function(){t.oApp.current_url=t.oApp.current_url.setQuery("cpage",e),t.oApp.scrollToComment(1,t.oApp.animatetime||1,"div#cmtPosition")})},dispDocumentList:function(){var t=e("div.bd_lst_wrp");if(!t.length)return!1;this.oApp.startAjax();var o=this,n=this.oApp.getPagesHandler();return n.done(function(o){o=e("<div>").append(e.parseHTML(o)).find("div.bd_lst_wrp"),t=e("div.bd_lst_wrp"),t.children("table.bd_lst").html(o.children("table.bd_lst").html()),t.children("form.bd_pg").html(o.children("form.bd_pg").html())}).fail(function(e,t,o){try{console.error("%s: %s, %o",t,o,e)}catch(n){}}).always(function(){o.oApp.stopAjax()}),n},dispDocumentListByPage:function(e){var t=this;return this.dispDocumentList({page:e}).done(function(){t.oApp.current_url=t.oApp.current_url.setQuery("page",e)})}})}(jQuery),jQuery(function(){oAJAXBoardDocPlugin=new AJAXBoardDocPlugin(oAJAXBoard)});